{{define "edit"}}
<div class="edit-recipe">
    <h1>Edit Recipe</h1>
    <form method="POST" action="/recipes/{{.ID}}" onsubmit="return handleSubmit(this);">
        <input type="hidden" name="_method" value="PUT">
        
        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="{{.Title}}" required>
        </div>

        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description">{{.Description}}</textarea>
        </div>

        <div class="form-group">
            <label for="prep_time">Prep Time (minutes):</label>
            <input type="number" id="prep_time" name="prep_time" value="{{.PrepTime.Minutes}}" required>
        </div>

        <div class="form-group">
            <label for="cook_time">Cook Time (minutes):</label>
            <input type="number" id="cook_time" name="cook_time" value="{{.CookTime.Minutes}}" required>
        </div>

        <div class="form-group">
            <label for="servings">Servings:</label>
            <input type="number" id="servings" name="servings" value="{{.Servings}}" required>
        </div>

        <button type="submit">Update Recipe</button>
    </form>
</div>

<script>
function handleSubmit(form) {
    // Convert POST to PUT
    const method = form._method.value;
    fetch(form.action, {
        method: method,
        body: new FormData(form)
    }).then(response => {
        if (response.ok) {
            // Fix: Store ID in a variable using template syntax
            const recipeId = "{{.ID}}";
            window.location.href = "/recipes/" + recipeId;
        } else {
            alert('Error updating recipe');
        }
    }).catch(error => {
        console.error('Error:', error);
        alert('Error updating recipe');
    });
    return false;
}
</script>
{{end}}